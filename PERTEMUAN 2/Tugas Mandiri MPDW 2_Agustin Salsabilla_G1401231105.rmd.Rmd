---
title: "IPM Individu Pertemuan 3"
author: "Agustin Salsabilla"
date: "2025-09-02"
output: html_document
---
```{r}
# Input Data IPM Sidoarjo (2015-2024)
tahun <- 2015:2024
ipm <- c(77.43, 78.17, 78.7, 79.5, 80.05, 80.29, 80.65, 81.02, 81.55, 82.31)
dt_ipm <- data.frame(tahun, ipm)

# Lihat datanya
print(dt_ipm)
```
```{r}
# Membuat model regresi OLS (Ordinary Least Squares)
model_awal <- lm(ipm ~ tahun, data = dt_ipm)
summary(model_awal)
```
**Observasi Awal:**
**Nilai Adjusted R-squared bernilai (0.9934)** dan koefisien `tahun` **sangat signifikan (p-value \< 0.001)**. Selanjutnya, kita akan tetap mengecek autokorelasi dengan diagnosis model regresi.
```{r}
# Ambil sisaan dari model
sisaan_awal <- residuals(model_awal)

# Plot sisaan terhadap waktu
plot(dt_ipm$tahun, sisaan_awal, type="o", pch=20, col="red",
     main="Plot Sisaan vs Waktu", xlab="Tahun", ylab="Sisaan")
abline(h=0, lty=2) # Garis referensi di y=0
```
**Yang dimaksud Plot Sisaannya adalah:**

Plot tersebut menunjukkan bahwa sisaan memiliki pola bergelombang (autokorelasi), sehingga model regresi awal belum cukup baik untuk data time series.

### 3.2. Diagnosis Formal (Uji Durbin-Watson)

Visual saja tidak cukup, kita butuh bukti formal. Kita gunakan Uji Durbin-Watson.

-   **H0 (Hipotesis Nol)**: Tidak ada autokorelasi. Sisaan saling bebas.

-   **H1 (Hipotesis Alternatif)**: Ada autokorelasi.

```{r}
library("lmtest")
dwtest(model_awal)
```
**Hasil Investigasi:**

-   P-value yang dihasilkan **sangat kecil (0.004829)**, yaitu di bawah tingkat signifikansi 0.05.

-   Kesimpulan: Kita **menolak H0**. Bukti sudah kuat. Model kita **terbukti ada autokorelasi**.

## Tahap 4: Penanganan (Memperbaiki Model)

Karena model kita "sakit", kita perlu menanganinya. Kita akan coba dua metode.

### Metode 1: Cochrane-Orcutt
```{r}
library(orcutt)
model_co <- cochrane.orcutt(model_awal)
summary(model_co)

# rho paling optimum
rho <- model_co$rho
cat("Rho optimum:", rho)
```
Nilai estimasi yang digunakan rho dalam model adalah 0.4308375. Maka, untuk mengecek apakah sisaan dari model yang sudah dikoreksi masih mengandung autokorelasi atau tidak.
```{r}
dwtest(model_co)
```
Hasil uji Durbin–Watson menunjukkan p-value = 0.07364 > 0.05, sehingga tidak terdapat autokorelasi yang signifikan pada sisaan model setelah dilakukan koreksi.

**Verifikasi Manual:**
```{r}
ipm.trans <- dt_ipm$ipm[-1] - dt_ipm$ipm[-10]*rho

tahun.trans <- dt_ipm$tahun[-1] - dt_ipm$tahun[-10]*rho
model_co_manual <- lm(ipm.trans~tahun.trans)

b0_co_manual <- coef(model_co_manual)[1]/(1-rho)
b1_co_manual <- coef(model_co_manual)[2]
cat("Koefisien manual Cochrane-Orcutt:\n")
cat("b0:", b0_co_manual, "\n")
cat("b1:", b1_co_manual, "\n")
```
Dengan demikian, model regresi setelah koreksi autokorelasi memberikan hasil estimasi yang tetap konsisten dengan model awal, namun sisaan sudah lebih mendekati sifat acak (tidak lagi mengandung autokorelasi yang signifikan).

### Metode 2: Hildreth-Lu

**Intuisi:** Metode ini lebih sistematis dan akan mencoba berbagai kemungkinan nilai ρ dan memilih satu yang menghasilkan **Sum of Squared Errors (SSE) terkecil.**
```{r}
#Penanganan Autokorelasi Hildreth lu
# Hildreth-Lu
hildreth.lu.func<- function(r, model_awal){
  x <- model.matrix(model_awal)[,-1]
  y <- model.response(model.frame(model_awal))
  n <- length(y)
  t <- 2:n
  y <- y[t]-r*y[t-1]
  x <- x[t]-r*x[t-1]
  
  return(lm(y~x))
}

#Pencariab rho yang meminimumkan SSE
r <- c(seq(0.1,0.9, by= 0.1))
tab <- data.frame("rho" = r, "SSE" = sapply(r, function(i){deviance(hildreth.lu.func(i, model_awal))}))
round(tab, 4)
```
Pertama-tama akan dicari di mana kira-kira ρ yang menghasilkan SSE minimum. Pada hasil di atas terlihat ρ minimum ketika 0.4. Namun, hasil tersebut masih kurang teliti sehingga akan dicari kembali ρ yang lebih optimum dengan ketelitian yang lebih. 
```{r}
#Rho optimal di sekitar 0.4
rOpt <- seq(0.3,0.6, by= 0.001)
tabOpt <- data.frame("rho" = rOpt, "SSE" = sapply(rOpt, function(i){deviance(hildreth.lu.func(i, model_awal))}))
head(tabOpt[order(tabOpt$SSE),])
```
```{r}
#Grafik SSE optimum
par(mfrow = c(1,1))
plot(tab$SSE ~ tab$rho , type = "l", xlab = "Rho", ylab = "SSE")
abline(v = tabOpt[tabOpt$SSE==min(tabOpt$SSE),"rho"], lty = 2, col="red",lwd=2)
text(x=0.431, y=0.1784626, labels = "rho=0.341", cex = 0.8)
```
```{r}
library("HoRM")
model_hl <- hildreth.lu(dt_ipm$ipm, dt_ipm$tahun, rho = 0.431)
summary(model_hl)
```
```{r}
#Transformasi Balik
cat("y = ", coef(model_hl)[1]/(1-0.341), "+", coef(model_hl)[2],"x", sep = "")
```
```{r}
#Deteksi autokorelasi
dwtest(model_hl)
```
**Hasil Penanganan (H-L):**

-   Plot yang dihasilkan secara visual menunjukkan nilai ρ mana yang memiliki SSE terendah.

-   Hasil summary memberikan model akhir yang juga sudah baik, dengan statistik D-W yang sudah membaik.

## Tahap 5: Evaluasi Akhir

Mari kita bandingkan SSE dan Statistik Durbin-Watson dari ketiga model untuk melihat seberapa efektif penanganan kita.
```{r}
# Menghitung SSE untuk setiap model secara manual
sse_awal <- sum(residuals(model_awal)^2)
sse_co <- sum(residuals(model_co)^2)
sse_hl <- sum(residuals(model_hl)^2)

# Membuat tabel perbandingan
data.frame(
  Metode = c("Model Awal (Sakit)", "Cochrane-Orcutt (Sehat)", "Hildreth-Lu (Sehat)"),
  SSE = c(sse_awal, sse_co, sse_hl),
  DW_Statistic = c(dwtest(model_awal)$statistic, model_co$DW[3], dwtest(model_hl)$statistic)
)
```
**Kesimpulan:**

- Pada Model Awal, nilai SSE sebesar 0.3606 dengan statistik Durbin-Watson 0.8928, yang menunjukkan adanya autokorelasi positif pada model.

- Baik metode Cochrane-Orcutt maupun Hildreth-Lu berhasil memperbaiki autokorelasi, ditunjukkan oleh meningkatnya nilai Durbin-Watson menjadi sekitar 1.42, lebih mendekati angka 2.

- Di antara keduanya, Hildreth-Lu menghasilkan nilai SSE yang paling kecil (0.1785), sehingga model lebih efisien dan akurat dibandingkan Cochrane-Orcutt yang memiliki SSE 0.5746.

- Dengan demikian, model akhir yang lebih layak digunakan adalah model hasil perbaikan dengan metode Hildreth-Lu, karena dapat mengatasi autokorelasi sekaligus meminimalkan kesalahan.